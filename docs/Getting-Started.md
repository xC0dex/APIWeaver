# Getting started with APIWeaver.OpenApi

`APIWeaver.OpenApi` is a lightweight .NET 9 library that extends the OpenAPI document generated by .NET's built-in OpenAPI document generator. Itâ€™s compatible with native AOT and offers extension methods and transformers for flexible customization.

## Installation

To get started with APIWeaver, install the `APIWeaver.OpenApi` NuGet package.

```shell
dotnet add package APIWeaver.OpenApi
```

Add the following using directive to your `Program.cs` file.

```csharp
using APIWeaver;
```

### Authentication

The package provides straightforward methods to add security schemes to your OpenAPI documents. The snippet below shows how to set up a security scheme:

```csharp
builder.Services.AddOpenApi(options =>
{
    // Adds a security scheme to the OpenAPI document and updates operations
    options.AddSecurityScheme("Bearer", scheme =>
    {
        scheme.In = ParameterLocation.Header;
        scheme.Type = SecuritySchemeType.OAuth2;
        scheme.Flows = new OpenApiOAuthFlows
        {
            ClientCredentials = new OpenApiOAuthFlow
            {
                TokenUrl = new Uri("https://localhost:5001/oauth2/token")
            }
        };
    });

    // Adds 401 and 403 responses based on endpoint requirements
    options.AddAuthResponse();
});
```

The `AddSecurityScheme` method adds a security scheme to the OpenAPI document and applies it to relevant operations. `AddAuthResponse` automatically adds 401 (Unauthorized) and 403 (Forbidden) responses to operations that require specific roles or policies.

### Examples

You can also add pre-configured examples for specific types in your OpenAPI document:

```csharp
builder.Services.AddApiWeaver(options =>
{
    options.AddExample(new Book
    {
        BookId = Guid.NewGuid(),
        Title = "APIWeaver",
        Description = "A book about APIWeaver",
        BookType = BookType.Documentation,
        Pages = 187
    });
});
```

### Other extensions

If you use the `Microsoft.Extensions.ApiDescription.Server` package with build-time document generation, you may want to use the static `BuildHelper` class, which provides a property that indicates whether the current execution context is the document generator. You can use it as follows:
```csharp
using static APIWeaver.BuildHelper;

...

if (!IsGenerationContext)
{
    builder.Services.AddSingleton<IMyService, MyService>();
}

var app = builder.Build();

if (IsGenerationContext)
{
    app.Run();
}
```

More features are coming soon...
